<td (dblclick)="switchCredentials()" (click)="openOptionBar(session);" (contextmenu)="openContextMenu($event, session)" class="{{eOptionIds[session.sessionId] ? 'selected' : (session.status !== eSessionStatus.inactive ? 'active' : '')}}">
  <img src="assets/images/{{getSessionTypeIcon(session.type)}}.png" alt="" title="" />
  &nbsp;
  <span class="{{session.status === eSessionStatus.active ? 'strong' : ''}}">{{session.sessionName}}</span>
  &nbsp;
  <i class="fal fa-thumbtack" *ngIf="workspaceService.getWorkspace().pinned.indexOf(session.sessionId) !== -1"></i>
</td>
<td (dblclick)="switchCredentials()" (click)="openOptionBar(session);" (contextmenu)="openContextMenu($event, session)" class="{{eOptionIds[session.sessionId] ? 'selected' : (session.status !== eSessionStatus.inactive ? 'active' : '')}}">
  <ng-container *ngIf="session.type !== eSessionType.awsIamUser">{{ session | detail }}</ng-container>
</td>
<td (dblclick)="switchCredentials()" (click)="openOptionBar(session);" (contextmenu)="openContextMenu($event, session)" class="{{eOptionIds[session.sessionId] ? 'selected' : (session.status !== eSessionStatus.inactive ? 'active' : '')}}">
  <span class="badge badge-rounded badge-{{getSessionProviderClass(session.type)}}">{{getSessionProviderLabel(session.type)}}</span>
</td>
<td (dblclick)="switchCredentials()" (click)="openOptionBar(session);" (contextmenu)="openContextMenu($event, session)" class="{{eOptionIds[session.sessionId] ? 'selected' : (session.status !== eSessionStatus.inactive ? 'active' : '')}}">
  <ng-container *ngIf="session.type !== eSessionType.azure">
  {{getProfileName(getProfileId(session))}}
  <a (click)="copyProfile(getProfileName(getProfileId(session)))" tooltip="Copy Profile Name"><i class="fal fa-copy"></i></a>
  </ng-container>
</td>
<td (dblclick)="switchCredentials()" (click)="openOptionBar(session);" (contextmenu)="openContextMenu($event, session)" class="{{eOptionIds[session.sessionId] ? 'selected' : (session.status !== eSessionStatus.inactive ? 'active' : '')}}">
  <span class="badge badge-{{session.status === eSessionStatus.active ? 'black' : 'gray'}}">{{session.region}}</span>
</td>
<td (dblclick)="switchCredentials()" (click)="openOptionBar(session);" (contextmenu)="openContextMenu($event, session)" class="{{eOptionIds[session.sessionId] ? 'selected' : (session.status !== eSessionStatus.inactive ? 'active' : '')}}">
  <i class="status-item fas fa-circle {{session.status === eSessionStatus.active ? 'active' : 'offline'}}" *ngIf="session.status !== eSessionStatus.pending"></i>
  <i class="status-item far fa-spinner-third fa-spin" *ngIf="session.status === eSessionStatus.pending"></i>
</td>



<div [matMenuTriggerFor]="menu" [style.position]="'absolute'" [style.left.px]="menuX" [style.top.px]="menuY"></div>
<mat-menu #menu>
  <button mat-menu-item (click)="startSession();">
    <i class="fal fa-play-circle"></i>&nbsp;
    <span>Start Session</span>
  </button>

  <div class="divider"></div>

  <button mat-menu-item (click)="changeRegionModalOpen($event, session);">
    <i class="fal fa-globe"></i>&nbsp;
    <span>Change Region</span>
  </button>
  <button mat-menu-item (click)="changeProfileModalOpen($event);">
    <i class="fal fa-user-circle"></i>&nbsp;
    <span>Change Named Profile</span>
  </button>
  <button mat-menu-item (click)="ssmModalOpen($event, session);">
    <i class="fal fa-list"></i>&nbsp;
    <span>View SSM Sessions</span>
  </button>

  <div class="divider"></div>

  <button mat-menu-item (click)="openAmazonConsole($event, session);">
    <i class="fal fa-cloud"></i>&nbsp;
    <span>View Amazon Console</span>
  </button>
  <button mat-menu-item (click)="openTerminal($event, session);">
    <i class="fal fa-terminal"></i>&nbsp;
    <span>Open Terminal</span>
  </button>

  <div class="divider"></div>

  <button mat-menu-item (click)="editSession(session, $event);">
    <i class="fal fa-pencil"></i>&nbsp;
    <span>Edit Session</span>
  </button>
  <button mat-menu-item (click)="pinSession(session, $event);">
    <i class="fal fa-thumbtack"></i>&nbsp;
    <span>Pin Session</span>
  </button>
  <button mat-menu-item (click)="deleteSession(session, $event);">
    <i class="fal fa-trash"></i>&nbsp;
    <span>Delete Session</span>
  </button>

</mat-menu>


<ng-container *ngIf="eOptionIds[session.sessionId]">
  <div class="option-bar" (click)="clearOptionIds();">
    <a class="icon-button start-session" (click)="startSession();" *ngIf="session.status === eSessionStatus.inactive"><i class="fad fa-play-circle"></i>&nbsp;Start Session</a>
    <a class="icon-button stop-session" (click)="stopSession();" *ngIf="session.status === eSessionStatus.active"><i class="fad fa-stop-circle"></i>&nbsp;Stop Session</a>
    <div>
      <a class="icon-button" (click)="changeRegionModalOpen($event, session);" tooltip="Change Region"><i class="fal fa-globe"></i></a>
      <a class="icon-button" *ngIf="session.type !== eSessionType.azure" (click)="changeProfileModalOpen($event);" tooltip="Change Named Profile"><i class="fal fa-user-circle"></i></a>
      <a class="icon-button" (click)="ssmModalOpen($event, session);" *ngIf="session.type !== eSessionType.azure" tooltip="View SSM sessions"><i class="fal fa-list"></i></a>
      <a class="icon-button" *ngIf="session.type === eSessionType.awsIamUser && session.status !== eSessionStatus.active" (click)="editSession(session, $event);" tooltip="Edit Session"><i class="fal fa-list"></i></a>

      <ng-container *ngIf="(session.type === eSessionType.awsIamRoleFederated || session.type === eSessionType.awsIamRoleChained || session.type === eSessionType.awsSsoRole)">
        <a class="icon-button" (click)="copyCredentials(session, 1, $event);" tooltip="Copy Account Number"><i class="fal fa-copy"></i></a>
        <a class="icon-button" (click)="copyCredentials(session, 2, $event);" tooltip="Copy Role ARN"><i class="fal fa-copy"></i></a>
      </ng-container>

      <span class="separator"></span>

      <a class="icon-button" (click)="pinSession(session, $event);" tooltip="Pin Session"><i class="fal fa-thumbtack"></i></a>
      <a class="icon-button" (click)="deleteSession(session, $event);" tooltip="Delete Session"><i class="fal fa-trash"></i></a>
    </div>

    <div class="session-name"><strong>{{session.sessionName}}</strong><br>{{session | detail}}</div>
  </div>
</ng-container>

<ng-template #ssmModalTemplate>
  <div class="modal-header">
    <a class="back" aria-label="Close" (click)="modalRef.hide();"><i class="fa fa-arrow-left"></i></a>
    <b>{{session.sessionName}}</b> - {{ session | detail }} | <b>SSM Session</b>
  </div>
  <div class="modal-body">

    <div class="ssm-tray">

      <b class="">Select a Region:</b>
      <ng-select bindLabel="region" bindValue="region" [items]="awsRegions" [(ngModel)]="selectedSsmRegion" placeholder="Select a Region for finding instances" (change)="changeSsmRegion($event, session);"></ng-select>

      <div class="loader" *ngIf="ssmLoading"><i class="fa fa-spinner fa-spin"></i></div>
      <div class="list-of-ssm" *ngIf="!ssmLoading">
        <ng-container *ngIf="!ssmLoading && !firstTimeSsm">
          <b>Select an EC2 Instance:</b><br>
          <input class="form-control" type="text" placeholder="search by..." (keyup)="searchSSMInstance($event)" />
        </ng-container>

        <ul class="ssm-ul" *ngIf="instances.length > 0">
          <li *ngFor="let instance of instances" class="ssm-card">
            <div>
              <span><b>{{instance.Name.length >= 24 ? instance.Name.substr(0, 21) + '...' : instance.Name}}</b> - {{instance.IPAddress}}</span>
              <button class="btn" (click)="startSsmSession(session.sessionId, instance.InstanceId)">
                <i class="fa fa-spinner fa-spin" *ngIf="instance.loading"></i>
                <span *ngIf="!instance.loading">Connect</span>
              </button>
            </div>
          </li>
        </ul>
      </div>

    </div>
  </div>
</ng-template>

<ng-template #defaultRegionModalTemplate>
  <div class="modal-header">
    <a class="back" aria-label="Close" (click)="modalRef.hide();"><i class="fa fa-arrow-left"></i></a>
    <b>{{session.sessionName}}</b> - {{session | detail }} | <b>Edit {{session.type === eSessionType.azure ? 'Location' : 'Region'}}</b>
  </div>
  <div class="modal-body">

    <div class="ssm-tray">

      <b class="">Select a default region for the session:</b>
      <ng-select bindLabel="{{session.type === eSessionType.azure ? 'location' : 'region'}}" bindValue="{{session.type === eSessionType.azure ? 'location' : 'region'}}" [items]="regionOrLocations" [(ngModel)]="selectedDefaultRegion" placeholder="{{placeholder}}"></ng-select>

      <button type="button" (click)="goBack();" class="pull-left disabled">Back</button>
      <button type="button" (click)="changeRegion();" [disabled]="!selectedDefaultRegion" [ngClass]="(!selectedDefaultRegion) ? 'pull-right disabled': 'pull-right'">Save</button>
    </div>
  </div>
</ng-template>

<ng-template #defaultProfileModalTemplate>
  <div class="modal-header">
    <a class="back" aria-label="Close" (click)="modalRef.hide();"><i class="fa fa-arrow-left"></i></a>
    <b>{{session.sessionName}}</b> - {{ session | detail }} | <b>Edit Profile</b>
  </div>
  <div class="modal-body">

    <div class="ssm-tray">

      <b class="">Select a profile for the session:</b>
      <ng-select bindLabel="name"
                 [addTag]="addNewProfile"
                 [items]="profiles"
                 [(ngModel)]="selectedProfile"
                 placeholder="select a profile"></ng-select>

      <button type="button" (click)="goBack();" class="pull-left disabled">Back</button>
      <button type="button" (click)="changeProfile();" [disabled]="!selectedProfile" [ngClass]="(!selectedProfile) ? 'pull-right disabled': 'pull-right'">Save</button>
    </div>
  </div>
</ng-template>
